# BubbleTranslate

**BubbleTranslate** is a Chrome browser extension designed to provide on-the-fly translation of text found within images (like manga, comics, webtoons) directly in your browser. It uses Optical Character Recognition (OCR) and machine translation technologies to display translated text over the original image content, helping bridge language barriers for visual media.

![BubbleTranslate Concept](placeholder_image_url.png) <!-- Optional: Add a screenshot or concept image URL here -->

## Features

- **On-Page Image Detection:** Automatically finds potential images containing translatable text on the current web page.
- **Cloud-Based OCR:** Extracts text from images using the Google Cloud Vision API.
- **Cloud-Based Translation:** Translates extracted text using the Google Cloud Translation API.
- **Text Overlay:** Displays the translated text directly over the corresponding text block on the original image.
- **User-Friendly Popup:** Simple browser action popup to initiate the translation process for the current page.
- **Configurable Options:** An options page to:
  - Set the required Google Cloud API Key.
  - Choose the desired target translation language.
  - Customize the appearance of the translation overlay (font size, text color, background color & transparency).
- **Status Feedback:** Provides status updates via the popup and the extension badge (e.g., errors).

## Technology Stack

- **TypeScript:** For robust, type-safe JavaScript development.
- **Webpack:** For bundling modules, compiling TypeScript, and managing assets.
- **HTML5 / CSS3:** For the structure and styling of the popup and options pages, as well as injected overlays.
- **Node.js / npm:** For managing dependencies and running build scripts.
- **Chrome Extension APIs:** Utilizing `chrome.storage`, `chrome.tabs`, `chrome.runtime`, `chrome.action`, etc.
- **Google Cloud Vision API:** For Optical Character Recognition (OCR).
- **Google Cloud Translation API:** For machine translation.

## Project Structure

[Detailed Project Structure](PROJECT.md)

- `src/`: Contains all the original source code written in TypeScript, HTML, and CSS.
- `dist/`: Contains the compiled and bundled output generated by Webpack. **This is the folder you load into Chrome.**

## Setup and Installation (Development)

1. **Clone the repository:**

   ```bash
   git clone <repository_url> # Replace with your repo URL
   cd BubbleTranslate
   ```

2. **Install dependencies:**

   ```bash
   npm install
   ```

## Build Process

Use the following npm scripts defined in `package.json`:

- **Production Build:** Compiles, bundles, and optimizes for production.

  ```bash
  npm run build
  ```

- **Development Build:** Compiles and bundles without optimization, includes source maps for easier debugging.

  ```bash
  npm run dev
  ```

- **Watch Mode:** Runs a development build and automatically rebuilds when source files change. Ideal for active development.

  ```bash
  npm run watch
  ```

- **Type Checking:** Runs the TypeScript compiler to check for type errors without generating output files.

  ```bash
  npm run typecheck
  ```

All build outputs are placed in the `dist/` directory.

## Loading the Extension in Chrome

1. **Build the extension:** Run `npm run build` (for testing the production version) or `npm run dev` (for development).
2. **Open Chrome** and navigate to `chrome://extensions`.
3. **Enable Developer Mode:** Toggle the switch in the top-right corner.
4. **Load Unpacked:** Click the "Load unpacked" button that appears.
5. **Select Folder:** Navigate to the project directory and select the **`dist`** folder.
6. The BubbleTranslate extension should now appear in your list of extensions.

**Note:** After making code changes and rebuilding (unless using `npm run watch`), you need to manually reload the extension from the `chrome://extensions` page by clicking the reload icon (â†») on the BubbleTranslate card.

## Configuration (Required)

This extension requires API credentials to function.

1. **Obtain a Google Cloud API Key:**
   - Go to the [Google Cloud Console](https://console.cloud.google.com/).
   - Create a new project or select an existing one.
   - Enable the **Cloud Vision API** and the **Cloud Translation API** for your project.
   - Create an API Key under "APIs & Services" -> "Credentials".
   - **Important:** Restrict your API key! For security, configure the key restrictions to only allow the Vision and Translation APIs, and consider adding website restrictions if possible (though this can be tricky with Chrome extensions).
2. **Configure the Extension:**
   - After loading the extension in Chrome, right-click the BubbleTranslate icon in your toolbar and select "Options", or navigate to the options page via `chrome://extensions`.
   - Paste your Google Cloud API Key into the designated field.
   - Select your preferred target language and customize overlay appearance if desired.
   - Click "Save Settings". The API key is stored locally using `chrome.storage.local`.

## How It Works (Simplified Flow)

1. **Initiation:** User clicks the "Translate Page" button in the popup.
2. **Trigger:** The popup sends a `startTranslation` message to the background script (service worker).
3. **Activation:** The background script identifies the active tab and sends a `triggerPageAnalysis` message to the content script injected into that tab.
4. **Image Discovery:** The content script scans the page's DOM, identifies potential images based on size/heuristics, and assigns unique IDs. It sends image URLs and IDs back to the background script via `processImage` messages.
5. **Processing Pipeline (Background):**
   - For each image message, the background script (specifically `translation_service.ts`) fetches the image data.
   - It converts the image data (e.g., to Base64).
   - It sends the image data to the Google Cloud Vision API (`api_client.ts`).
6. **OCR & Translation (Cloud):**
   - Vision API performs OCR and returns text blocks with bounding boxes.
   - The background script extracts the text and sends it to the Google Cloud Translation API.
7. **Result Handling (Background):**
   - The background script receives the translated text.
   - It sends a `displayBlockTranslation` message (containing the original image ID, translated text, and bounding box) back to the content script.
8. **Overlay Display:** The content script receives the translation data and uses the `overlay_manager.ts` to create an HTML overlay element, position it correctly using the bounding box coordinates over the original image, style it according to user settings, and populate it with the translated text.
9. **Error Handling:** If errors occur (API key issues, network problems, inability to find tabs, content script errors), feedback is provided via console logs and the extension action badge.

## Future Enhancements

See the `TODO.md` file for planned features and improvements.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
